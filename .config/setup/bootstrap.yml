---
- name: Bootstrap personal environment
  hosts: localhost
  vars_prompt:
    - name: ssd_trim
      prompt: Setup SSD trim? [Y/n]
      private: false
    - name: github_email
      prompt: Github email
      private: false

  tasks:
    - name: Check for dotfiles
      stat:
        path: "{{ ansible_env.HOME }}/.config/.dotfiles-git/HEAD"
      register: dotfiles_head
    - name: Clone dotfiles repository
      git:
        accept_hostkey: true
        repo: https://github.com/Vinschers/dotfiles.git
        dest: "{{ ansible_env.HOME }}/.config/.dotfiles-git"
        bare: true
      when: not dotfiles_head.stat.exists
    - name: Install dotfiles
      shell: |
        git --git-dir="{{ ansible_env.HOME }}/.config/.dotfiles-git/" --work-tree="{{ ansible_env.HOME }}" config --local status.showUntrackedFiles no
        git --git-dir="{{ ansible_env.HOME }}/.config/.dotfiles-git/" --work-tree="{{ ansible_env.HOME }}" restore --staged "{{ ansible_env.HOME }}"
        git --git-dir="{{ ansible_env.HOME }}/.config/.dotfiles-git/" --work-tree="{{ ansible_env.HOME }}" update-index --assume-unchanged "{{ ansible_env.HOME }}/.config/shell/environment/local.sh"
        git --git-dir="{{ ansible_env.HOME }}/.config/.dotfiles-git/" --work-tree="{{ ansible_env.HOME }}" update-index --assume-unchanged "{{ ansible_env.HOME }}/.config/octave/octaverc"

    - name: Setup Arch Linux
      import_role:
        name: arch
