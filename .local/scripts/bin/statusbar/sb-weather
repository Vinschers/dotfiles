#!/bin/sh

n=3
logfile="${XDG_CACHE_HOME:-$HOME/.cache}/weather"
read -r opt < "$logfile" || opt=0

update_opt () {
	param=$1
	opt=$(( (opt + param) % n ))
	opt=${opt#-}
	echo "$opt" > "$logfile"
}

case $BUTTON in
	1) update_opt 1 ;;
esac

printf "^c%s^" "$1"
case $opt in
	0) curl -sf "wttr.in?format=%c%t" | sed -e "s/  / /g" -e "s/☀️//g" -e "s/⛅️//g" -e "s/☁️//g" ;;
	1) curl -sf "wttr.in?format=+%w+++%h+++%p" ;;
	2) curl -sf "wttr.in?format=%m+%P" ;;
esac
