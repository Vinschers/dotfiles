#!/bin/python

import sys
import os
import json

from pywal import colors
from material_color_utilities_python import Image, themeFromImage, hexFromArgb


def get_colors(path):
    return colors.get(path)


def get_material(path, mode="dark"):
    img = Image.open(path)

    basewidth = 256
    wpercent = basewidth / float(img.size[0])
    hsize = int((float(img.size[1]) * float(wpercent)))

    img = img.resize((basewidth, hsize), Image.Resampling.LANCZOS)

    theme = themeFromImage(img).get("schemes", {}).get(mode).props
    theme = {k: hexFromArgb(v) for k, v in theme.items()}

    return theme


if __name__ == "__main__":
    if len(sys.argv) < 2:
        exit(1)

    path = sys.argv[1]

    if not os.path.isfile(path):
        exit(1)

    mode = "dark"
    if len(sys.argv) > 2 and sys.argv[2] in ["light", "dark"]:
        mode = sys.argv[2]

    theme = get_material(path, mode) | get_colors(path)

    print(json.dumps(theme))
